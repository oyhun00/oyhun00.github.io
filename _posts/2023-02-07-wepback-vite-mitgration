---
title: Webpack -> Vite Migration
author: yong
date: 2023-02-07 11:58:00 +0800
categories: [React, FE Tech]
tags: [React, Vite, Webpack, Bundler]
---

# AD Platform Webpack â†’ Vite Migration

íšŒì‚¬ì—ì„œ ê¸°ì¡´ AD Platformì—ì„œ ìƒˆë¡œìš´ Featureë¥¼ ê°œë°œí•˜ëŠ” ë„ì¤‘, í”„ë¡œì íŠ¸ ê·œëª¨ ìì²´ê°€ ì»¤ì„œ ê·¸ëŸ°ì§€ HMRê³¼ ì„œë²„ë¥¼ ì¬ì‹œì‘í•˜ê±°ë‚˜ ë¹Œë“œí•  ë•Œ ì‹œê°„ì´ ìƒë‹¹íˆ ì˜¤ë˜ ê±¸ë ¸ë‹¤. ê·¸ ì „ì— ë‹¤ë¥¸ í”„ë¡œì íŠ¸ì—ì„œ Viteë¥¼ ë„ì…í–ˆë˜ ê¸°ì–µì´ ë– ì˜¬ë¼ ì´ë²ˆì—” Webpackì—ì„œ Viteë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í•´ë³´ê¸°ë¡œ í–ˆë‹¤.

# âš™ï¸ ê¸°ì¡´ í™˜ê²½

| Dependencies | Version |
| ------------ | ------- |
| react        | 17.0.2  |
| webpack      | 4.42.0  |

# ğŸ”„ Migration

## ğŸ”¹Â Vite Install

Viteì—ì„œ React í”ŒëŸ¬ê·¸ì¸ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í–ˆë‹¤.

```bash
yarn add -D vite @vitejs/plugin-react
```

ì„¤ì¹˜ í›„, í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `vite.config.ts` íŒŒì¼ê³¼ `index.html` íŒŒì¼ì„ ìƒì„±í•˜ì—¬ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•œë‹¤.

```tsx
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import envCompatible from "vite-plugin-env-compatible";

export default defineConfig({
  plugins: [react(), envCompatible({ prefix: "REACT_APP" })],
  publicDir: false,
});
```

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    ...
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="./src/index.tsx"></script>
  </body>
</html>
```

`index.html` íŒŒì¼ì„ public ë””ë ‰í„°ë¦¬ê°€ ì•„ë‹Œ ë£¨íŠ¸ì— ìƒì„±í•œ ì´ìœ ëŠ” Viteì˜ ì˜ë„ì ì¸ êµ¬ì¡°ì´ë‹¤. ì¶”ê°€ì ì¸ ë²ˆë“¤ë§ ê³¼ì • ì—†ì´ `index.html` íŒŒì¼ì´ ì•±ì˜ ì§„ì…ì ì´ ë˜ê¸° ìœ„í•œ ì˜ë„ì´ë‹¤.

```bash
yarn add -D vite-plugin-env-compatible
```

Viteì—ì„  í™˜ê²½ ë³€ìˆ˜ì— ì ‘ê·¼í•  ë•Œ, `process.env` ëŒ€ì‹  `import.meta.env` ë¥¼ í†µí•´ ì ‘ê·¼í•œë‹¤. í•˜ì§€ë§Œ ê¸°ì¡´ í”„ë¡œì íŠ¸ì—ì„œì˜ í™˜ê²½ ë³€ìˆ˜ë¥¼ Viteì˜ í™˜ê²½ ë³€ìˆ˜ ì ‘ê·¼ ë°©ì‹ìœ¼ë¡œ ìˆ˜ì •í•˜ë ¤ë©´ ë¦¬ì†ŒìŠ¤ë¥¼ ë§ì´ ì†Œìš”í•˜ê²Œ ëœë‹¤. ë”°ë¼ì„œ ê¸°ì¡´ `process.env` ì„ í†µí•´ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ë„ì™€ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•œë‹¤.

## ğŸ”¹Â Proxy

Viteì—ì„œ í”„ë¡ì‹œëŠ” `vite.config.ts` ì—ì„œ ì„¤ì •í•  ìˆ˜ ìˆë‹¤. [ì°¸ê³ ](https://vitejs-kr.github.io/config/server-options.html#server-proxy)

`vite.config.ts` íŒŒì¼ì—ì„œ í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ í”„ë¡ì‹œë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ì„¤ì •í•˜ì˜€ë‹¤.

```tsx
...

export default ({ mode }) => {
	const envDir = `../environments`
  process.env = { ...process.env, ...loadEnv(mode, envDir, '') }

	...
	return defineConfig({
		...
		server: {
	    proxy: {
	      '/auth': {
	        target: `${AuthURL}`,
	        changeOrigin: true,
	        rewrite: path => path.replace(/^\/api/, ''),
	      },
				...
			}
		},
		preview: {
	    proxy: {
	      '/auth': {
	        target: `${AuthURL}`,
	        changeOrigin: true,
	        rewrite: path => path.replace(/^\/api/, ''),
	      },
				...
			}
		}
	})
}
```

# ğŸš€Â Trouble Shooting

## ğŸ”¹Â The following dependencies are imported but could not be resolved

ê¸°ë³¸ì ì¸ Vite ì„¤ì • ì™„ë£Œ í›„, ì‹¤í–‰ í–ˆë”ë‹ˆ ë‹¤ìŒê³¼ ê°™ì´ ì—ëŸ¬ê°€ ë‚˜íƒ€ë‚¬ë‹¤.

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/2dfff102-18bb-496c-ab40-6864165349ab/Untitled.png)

ì´ëŠ” Viteì˜ ëª¨ë“ˆ ë²ˆë“¤ëŸ¬ì¸ Rollupì˜ íŒŒì¼ íƒìƒ‰ ë°©ì‹ ë•Œë¬¸ì¸ë°, rollup ì„¤ì •ì˜ `build.rollupOptions.external` ì´ ì™¸ë¶€ íŒŒì¼ë³´ë‹¤ `/` ì„ ë¨¼ì € ì°¾ê¸° ë•Œë¬¸ì— ë°œìƒí•œ ì˜¤ë¥˜ì˜€ë‹¤.

```html
<body>
  <div id="root"></div>
  <script type="module" src="./src/index.tsx"></script>
</body>
```

ê¸°ì¡´ì˜ `index.html` íŒŒì¼ì—ì„œëŠ” ìœ„ì™€ ê°™ì´ ì„¤ì •ë˜ì–´ ìˆì—ˆë‹¤. ì•„ë˜ì²˜ëŸ¼ `.` ë¥¼ ì œê±°í•˜ë‹ˆ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ì´ ì™„ë£Œë˜ì—ˆë‹¤.

```html
<body>
  <div id="root"></div>
  <script type="module" src="/src/index.tsx"></script>
</body>
```

## ğŸ”¹Â Internal server error: Failed to resolve import "â€¦" from "src/index.tsx". Does the file exist?

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/68233871-a56c-4fe9-8c45-b7da913c7df4/Untitled.png)

ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ë“¯ í–ˆìœ¼ë‚˜ ì´ë²ˆì—ë„ ê²½ë¡œë¥¼ ì°¾ì§€ ëª»í•´ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•˜ëŠ” ì—ëŸ¬ê°€ ë°œìƒí–ˆë‹¤. í”„ë¡œì íŠ¸ ë‚´ë¶€ì—ì„œ ëª¨ë“  íŒŒì¼ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ê¸°ì—” í° ë¦¬ì†ŒìŠ¤ ì†Œëª¨ê°€ í•„ìš”í•´ë³´ì˜€ë‹¤. ì´ëŠ” vite-tsconfig-paths í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤. í•´ë‹¹ í”ŒëŸ¬ê·¸ì¸ì€ TypeScriptì˜ ê²½ë¡œ ë§¤í•‘ì„ ê·¸ëŒ€ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œë” ë„ì™€ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì´ë‹¤.

```html
yarn add -D vite-tsconfig-paths
```

ê·¸ë¦¬ê³  `vite.config.js` íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•˜ì˜€ë‹¤.

```tsx
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";
import tsconfigPaths from "vite-tsconfig-paths";
import envCompatible from "vite-plugin-env-compatible";

export default defineConfig({
  plugins: [react(), tsconfigPaths(), envCompatible({ prefix: "REACT_APP" })],
  publicDir: false,
  base: "/",
});
```

## ğŸ”¹Â Require is not defined

ViteëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ES Module ë°©ì‹ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì—, require ë¬¸(CJS)ì„ ì‚¬ìš©í•˜ë©´ `require is not defined` ì—ëŸ¬ë¥¼ ì¶œë ¥í•œë‹¤.

ì´ëŠ” vite í”„ë¡œì íŠ¸ì—ì„œ requireë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œë” ë„ì™€ì£¼ëŠ” í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•˜ì—¬ í•´ê²°í•˜ì˜€ë‹¤. [ë§í¬](https://www.npmjs.com/package/vite-plugin-require)

```bash
yarn add vite-plugin-require
```

```tsx
...
import vitePluginRequire from 'vite-plugin-require'

export default defineConfig({
  plugins: [
		...
		vitePluginRequire({
      fileRegex: /.ts$|.tsx$|.jpg$|.png$/,
    }),
		...
	],
  ...
})
```

## ğŸ”¹Â Please import the top-level fullcalendar lib before attempting to import a plugin.

í•´ë‹¹ ì´ìŠˆëŠ” fullcalendar ë””íœë˜ì‹œ ë²„ì „ì„ ì—…ë°ì´íŠ¸í•˜ë©° í•´ê²°ë˜ì—ˆë‹¤.

ì´ ì™¸ì—ë„ ì—¬ëŸ¬ê°€ì§€ ìì§ˆêµ¬ë ˆí•œ í”ŒëŸ¬ê·¸ì¸ ë²„ì „ ì¶©ëŒ, ê²½ë¡œ ì˜¤íƒ€(ì´ê±° ë•Œë¬¸ì— í•˜ë£¨ ì¢…ì¼ ì‚½ì§ˆ) ë“±ë“± ì´ìŠˆê°€ ë§ì´ ë‚˜íƒ€ë‚¬ì—ˆë‹¤.

# ğŸŒŸÂ ê²°ê³¼

## ğŸ”¹Â Hot Module Reload

- Webpack
  <img src="/HMR-Webpack.gif" alt="HMR-Webpack">

- Vite
  <img src="/HMR-Vite.gif" alt="HMR-Vite">

## ğŸ”¹Â Build Time

- Webpack: 45s
- Vite: 24s

## ğŸ”¹Â Cold Start

- Webpack: ì•½ 16s
- Vite: ì•½ 4s

ì•„ì§ ì „ì²´ì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ í•´ë³´ì§„ ëª»í–ˆì§€ë§Œ, ì†ë„ê°€ ë¹„ì•½ì ìœ¼ë¡œ í–¥ìƒë˜ì–´ ì•ìœ¼ë¡œ ê°œë°œ ìƒì‚°ì„±ë„ ê°™ì´ í–¥ìƒ ë  ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•˜ê³  ìˆë‹¤.
